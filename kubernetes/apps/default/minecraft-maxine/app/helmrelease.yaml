---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: java-maxine
  namespace: default
spec:
  interval: 15m
  chart:
    spec:
      chart: minecraft
      version: 4.8.0
      sourceRef:
        kind: HelmRepository
        name: itzg
        namespace: flux-system
  maxHistory: 2
  install:
    createNamespace: true
    timeout: 11m
    remediation:
      retries: 3
  upgrade:
    cleanupOnFail: true
    timeout: 11m
    remediation:
      retries: 3
  uninstall:
    keepHistory: false
  values:
    controller:
      annotations:
        reloader.stakater.com/auto: "true"
    image:
      repository: itzg/minecraft-server
      tag: latest@sha256:2dac9ce79aa6e106cd0107ed2b47e6c7cb73f133fd23057faa160739cf6fc2b0
    resources:
      requests:
        memory: 8Gi
        cpu: 500m
      limits:
        memory: 8Gi
    livenessProbe:
      command:
        - mc-health
      initialDelaySeconds: 540
      periodSeconds: 5
      failureThreshold: 30
      successThreshold: 1
      timeoutSeconds: 1
    readinessProbe:
      command:
        - mc-health
      initialDelaySeconds: 540
      periodSeconds: 5
      failureThreshold: 30
      successThreshold: 1
      timeoutSeconds: 1
    startupProbe:
      command:
        - mc-health
      enabled: false
      failureThreshold: 120
      periodSeconds: 10
    minecraftServer:
      eula: true
      version: "1.18.2"
      type: "FORGE"
      forgeVersion: 40.2.1
      # downloadModpackUrl: https://www.curseforge.com/api/v1/mods/711537/files/4558204/download
      # cfServerMod: https://www.curseforge.com/api/v1/mods/711537/files/4558204/download
      difficulty: hard
      maxWorldSize: 10000
      whitelist: AurumAutomaton,OmniSnuggle,MaxTheMooshroom,SkyeMeows,Okuumu,melanomar,jkleinveld,greytux,KennyTheLogician,Krivy
      icon: https://vaulthunters.gg/assets/vh-logo-lg-a4fbcbdd.png
      motd: "Welcome to VaultHunters gaymers! Powered by Serpie's Service Stack."
      ops: AurumAutomaton,MaxTheMooshroom
      allowNether: true
      announcePlayerAchievements: true
      enableCommandBlock: true
      generateStructures: true
      hardcore: false
      maxBuildHeight: 320
      maxTickTime: 60000
      viewDistance: 10
      spawnProtection: 0
      gameMode: survival
      levelType: DEFAULT
      memory: 6000M
      jvmOpts: ""
      jvmXXOpts: "-XX:+UseG1GC -Dsun.rmi.dgc.server.gcInterval=2147483646 -XX:+UnlockExperimentalVMOptions -XX:G1NewSizePercent=20 -XX:G1ReservePercent=20 -XX:MaxGCPauseMillis=50 -XX:G1HeapRegionSize=32M"
      onlineMode: true
      serviceType: LoadBalancer
      servicePort: 62558
      LoadBalancerIP: 10.0.10.124
      rcon:
        enabled: true
        port: 25575
        existingSecret: rcon-password
        secretKey: rcon-password
        serviceType: ClusterIP
    persistence:
      storageClass: nfs
      dataDir:
        enabled: true
        size: 1Gi
    mcBackup:
      enabled: true
      image: itzg/mc-backup
      tag: latest@sha256:3f7c228141995c0abebf8e2b25b85547970401d723bb703b23fde30744aca778
      persistence:
        storageClass: nfs
        backupdir:
          enabled: true
          Size: 1Gi
